<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign Up - SplitEase</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="styles.css" rel="stylesheet" />
    <style>
      .glass-card {
        margin-top: 100px; 
      }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg"></div>
    <div class="floating-orb orb-1"></div>
    <div class="floating-orb orb-2"></div>
    <div class="floating-orb orb-3"></div>

    <div class="container-fluid vh-100 d-flex align-items-center justify-content-center">
        <div class="row w-100 justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="glass-card p-5">
                    <div class="text-center mb-4">
                        <h1 class="gradient-text fw-bold mb-2">
                            <i class="bi bi-piggy-bank me-2"></i>SplitEase
                        </h1>
                        <p class="text-muted">Create your account and start splitting expenses!</p>
                    </div>

                    <form id="signupForm">
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="firstName" class="form-label fw-semibold">First Name</label>
                                <input type="text" class="form-control gradient-input" id="firstName" placeholder="First name" required />
                            </div>
                            <div class="col-md-6">
                                <label for="lastName" class="form-label fw-semibold">Last Name</label>
                                <input type="text" class="form-control gradient-input" id="lastName" placeholder="Last name" required />
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label fw-semibold">Email Address</label>
                            <input type="email" class="form-control gradient-input" id="email" placeholder="Enter your email" required />
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label fw-semibold">Password</label>
                            <input type="password" class="form-control gradient-input" id="password" placeholder="Create a password" required />
                        </div>

                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label fw-semibold">Confirm Password</label>
                            <input type="password" class="form-control gradient-input" id="confirmPassword" placeholder="Confirm your password" required />
                        </div>

                        <div class="mb-3">
                          <label for="age" class="form-label fw-semibold">Age</label>
                          <input type="number" class="form-control gradient-input" id="age" min="0" value="18" required />
                        </div>


                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="isActive" checked />
                            <label for="isActive" class="form-check-label fw-semibold">Active User</label>
                        </div>

                        <fieldset class="mb-3 border p-3 rounded">
                            <legend class="fw-semibold">Address</legend>
                            <div class="mb-2">
                                <input type="text" class="form-control gradient-input" id="addressStreet" placeholder="Street" />
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control gradient-input" id="addressCity" placeholder="City" />
                            </div>
                            <div>
                                <input type="text" class="form-control gradient-input" id="addressZipCode" placeholder="Zip Code" />
                            </div>
                        </fieldset>

                        <button type="submit" class="btn btn-gradient w-100 py-3 fw-bold mb-3">
                            <i class="bi bi-person-plus me-2"></i>Create Account
                        </button>
                    </form>

                    <hr class="my-4" />

                    <div class="text-center">
                        <p class="mb-2">Already have an account?</p>
                        <a href="login.html" class="btn btn-outline-primary w-100">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const API_BASE = 'http://localhost:4000/api';

        function showError(msg) { alert(msg); }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('signupForm');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const firstName = document.getElementById('firstName')?.value.trim() || '';
                const lastName = document.getElementById('lastName')?.value.trim() || '';
                const name = `${firstName} ${lastName}`.trim();
                const email = document.getElementById('email')?.value.trim() || '';
                const password = document.getElementById('password')?.value || '';
                const confirmPassword = document.getElementById('confirmPassword')?.value || '';
                const age = parseInt(document.getElementById('age')?.value) || 18;
                const isActive = document.getElementById('isActive')?.checked || false;
                const address = {
                    street: document.getElementById('addressStreet')?.value.trim() || '',
                    city: document.getElementById('addressCity')?.value.trim() || '',
                    zipCode: document.getElementById('addressZipCode')?.value.trim() || ''
                };


                if (!firstName || !lastName) return showError('Please enter first and last name');
                if (!email) return showError('Please enter email');
                if (!password) return showError('Please enter password');
                if (password !== confirmPassword) return showError('Passwords do not match');

                try {
                    const res = await fetch(`${API_BASE}/auth/signup`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            email,
                            password,
                            age,
                            isActive,
                            address,
                        }),
                    });
                    const data = await res.json();
                    if (!res.ok) return showError(data.message || 'Signup failed');

                    // Persist token and user for dashboard
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));

                    // Optional: fetch /auth/me to ensure walletBalance present immediately
                    try {
                        const meRes = await fetch(`${API_BASE}/auth/me`, {
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${data.token}`
                            }
                        });
                        const me = await meRes.json();
                        if (me?.user) {
                            localStorage.setItem('user', JSON.stringify(me.user));
                        }
                    } catch {}

                    window.location.href = 'index.html';
                } catch (err) {
                    showError('Network error');
                }
            });
        });
    </script>
</body>
</html>
